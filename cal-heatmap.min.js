/*! cal-heatmap v4.0.0 (Wed Nov 09 2022 20:45:15)
 *  ---------------------------------------------
 *  Cal-Heatmap is a javascript module to create calendar heatmap to visualize time series data
 *  https://github.com/wa0x6e/cal-heatmap
 *  Licensed under the MIT license
 *  Copyright 2014 Wan Qi Chen
 */
const d3="function"==typeof require?require("d3"):window.d3,CalHeatMap=function(){"use strict";const p=this;this.allowedDataType=["json","csv","tsv","txt"],this.options={itemSelector:"#cal-heatmap",paintOnLoad:!0,range:12,cellSize:10,cellPadding:2,cellRadius:0,domainGutter:2,domainMargin:[0,0,0,0],domain:"hour",subDomain:"min",colLimit:null,rowLimit:null,weekStartOnMonday:!0,dayLabel:!1,start:new Date,minDate:null,maxDate:null,data:"",dataType:this.allowedDataType[0],dataPostPayload:null,dataRequestHeaders:null,considerMissingDataAsZero:!1,loadOnInit:!0,verticalOrientation:!1,domainDynamicDimension:!0,label:{position:"bottom",align:"center",offset:{x:0,y:0},rotate:null,width:100,height:null},legend:[10,20,30,40],displayLegend:!0,legendCellSize:10,legendCellPadding:2,legendMargin:[0,0,0,0],legendVerticalPosition:"bottom",legendHorizontalPosition:"left",legendOrientation:"horizontal",legendColors:null,highlight:[],itemName:["item","items"],domainLabelFormat:null,subDomainTitleFormat:{empty:"{date}",filled:"{count} {name} {connector} {date}"},subDomainDateFormat:null,subDomainTextFormat:null,legendTitleFormat:{lower:"less than {min} {name}",inner:"between {down} and {up} {name}",upper:"more than {max} {name}"},animationDuration:500,nextSelector:!1,previousSelector:!1,itemNamespace:"cal-heatmap",tooltip:!1,onClick:null,onMouseOver:null,onMouseOut:null,afterLoad:null,afterLoadNextDomain:null,afterLoadPreviousDomain:null,onComplete:null,onResize:null,afterLoadData:function(t){return t},afterUpdate:null,onMaxDomainReached:null,onMinDomainReached:null,onTooltip:function(t){return t}},this._domainType={min:{name:"minute",level:10,maxItemNumber:60,defaultRowNumber:10,defaultColumnNumber:6,row:function(t){return p.getSubDomainRowNumber(t)},column:function(t){return p.getSubDomainColumnNumber(t)},position:{x:function(t){return Math.floor(t.getMinutes()/p._domainType.min.row(t))},y:function(t){return t.getMinutes()%p._domainType.min.row(t)}},format:{date:"%H:%M, %A %B %-e, %Y",legend:"",connector:"at"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime()}},hour:{name:"hour",level:20,maxItemNumber:function(t){switch(p.options.domain){case"day":return 24;case"week":return 168;case"month":return 24*(p.options.domainDynamicDimension?p.getDayCountInMonth(t):31)}},defaultRowNumber:6,defaultColumnNumber:function(t){switch(p.options.domain){case"day":return 4;case"week":return 28;case"month":return p.options.domainDynamicDimension?p.getDayCountInMonth(t):31}},row:function(t){return p.getSubDomainRowNumber(t)},column:function(t){return p.getSubDomainColumnNumber(t)},position:{x:function(t){return"month"===p.options.domain?0<p.options.colLimit||0<p.options.rowLimit?Math.floor((t.getHours()+24*(t.getDate()-1))/p._domainType.hour.row(t)):Math.floor(t.getHours()/p._domainType.hour.row(t))+4*(t.getDate()-1):"week"===p.options.domain?0<p.options.colLimit||0<p.options.rowLimit?Math.floor((t.getHours()+24*p.getWeekDay(t))/p._domainType.hour.row(t)):Math.floor(t.getHours()/p._domainType.hour.row(t))+4*p.getWeekDay(t):Math.floor(t.getHours()/p._domainType.hour.row(t))},y:function(t){let e=t.getHours();if(0<p.options.colLimit||0<p.options.rowLimit)switch(p.options.domain){case"month":e+=24*(t.getDate()-1);break;case"week":e+=24*p.getWeekDay(t)}return Math.floor(e%p._domainType.hour.row(t))}},format:{date:"%Hh, %A %B %-e, %Y",legend:"%H:00",connector:"at"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime()}},day:{name:"day",level:30,maxItemNumber:function(t){switch(p.options.domain){case"week":return 7;case"month":return p.options.domainDynamicDimension?p.getDayCountInMonth(t):31;case"year":return p.options.domainDynamicDimension?p.getDayCountInYear(t):366}},defaultColumnNumber:function(t){switch(t=new Date(t),p.options.domain){case"week":return 1;case"month":return p.options.domainDynamicDimension&&!p.options.verticalOrientation?p.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-p.getWeekNumber(t)+1:6;case"year":return p.options.domainDynamicDimension?p.getWeekNumber(new Date(t.getFullYear(),11,31))-p.getWeekNumber(new Date(t.getFullYear(),0))+1:54}},defaultRowNumber:7,row:function(t){return p.getSubDomainRowNumber(t)},column:function(t){return p.getSubDomainColumnNumber(t)},position:{x:function(t){switch(p.options.domain){case"week":return Math.floor(p.getWeekDay(t)/p._domainType.day.row(t));case"month":return 0<p.options.colLimit||0<p.options.rowLimit?Math.floor((t.getDate()-1)/p._domainType.day.row(t)):p.getWeekNumber(t)-p.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));case"year":return 0<p.options.colLimit||0<p.options.rowLimit?Math.floor((p.getDayOfYear(t)-1)/p._domainType.day.row(t)):p.getWeekNumber(t)}},y:function(t){let e=p.getWeekDay(t);if(0<p.options.colLimit||0<p.options.rowLimit)switch(p.options.domain){case"year":e=p.getDayOfYear(t)-1;break;case"week":e=p.getWeekDay(t);break;case"month":e=t.getDate()-1}return Math.floor(e%p._domainType.day.row(t))}},format:{date:"%A %B %-e, %Y",legend:"%e %b",connector:"on"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()}},week:{name:"week",level:40,maxItemNumber:54,defaultColumnNumber:function(t){switch(t=new Date(t),p.options.domain){case"year":return p._domainType.week.maxItemNumber;case"month":return p.options.domainDynamicDimension?p.getWeekNumber(new Date(t.getFullYear(),t.getMonth()+1,0))-p.getWeekNumber(t):5}},defaultRowNumber:1,row:function(t){return p.getSubDomainRowNumber(t)},column:function(t){return p.getSubDomainColumnNumber(t)},position:{x:function(t){switch(p.options.domain){case"year":return Math.floor(p.getWeekNumber(t)/p._domainType.week.row(t));case"month":return Math.floor(p.getMonthWeekNumber(t)/p._domainType.week.row(t))}},y:function(t){return p.getWeekNumber(t)%p._domainType.week.row(t)}},format:{date:"%B Week #%W",legend:"%B Week #%W",connector:"in"},extractUnit:function(t){const e=new Date(t.getFullYear(),t.getMonth(),t.getDate());let n=e.getDay()-(p.options.weekStartOnMonday?1:0);return n<0&&(n=6),e.setDate(e.getDate()-n),e.getTime()}},month:{name:"month",level:50,maxItemNumber:12,defaultColumnNumber:12,defaultRowNumber:1,row:function(){return p.getSubDomainRowNumber()},column:function(){return p.getSubDomainColumnNumber()},position:{x:function(t){return Math.floor(t.getMonth()/p._domainType.month.row(t))},y:function(t){return t.getMonth()%p._domainType.month.row(t)}},format:{date:"%B %Y",legend:"%B",connector:"in"},extractUnit:function(t){return new Date(t.getFullYear(),t.getMonth()).getTime()}},year:{name:"year",level:60,row:function(){return p.options.rowLimit||1},column:function(){return p.options.colLimit||1},position:{x:function(){return 1},y:function(){return 1}},format:{date:"%Y",legend:"%Y",connector:"in"},extractUnit:function(t){return new Date(t.getFullYear()).getTime()}}};for(const e in this._domainType){var t;this._domainType.hasOwnProperty(e)&&(t=this._domainType[e],this._domainType["x_"+e]={name:"x_"+e,level:t.type,maxItemNumber:t.maxItemNumber,defaultRowNumber:t.defaultRowNumber,defaultColumnNumber:t.defaultColumnNumber,row:t.column,column:t.row,position:{x:t.position.y,y:t.position.x},format:t.format,extractUnit:t.extractUnit})}function f(t,e){let n=p.options.cellSize*p._domainType[p.options.subDomain].column(t)+p.options.cellPadding*p._domainType[p.options.subDomain].column(t);return 2===arguments.length&&!0===e?n+=p.domainHorizontalLabelWidth+p.options.domainGutter+p.options.domainMargin[1]+p.options.domainMargin[3]:n}function D(t,e){let n=p.options.cellSize*p._domainType[p.options.subDomain].row(t)+p.options.cellPadding*p._domainType[p.options.subDomain].row(t);return 2===arguments.length&&!0===e&&(n+=p.options.domainGutter+p.domainVerticalLabelHeight+p.options.domainMargin[0]+p.options.domainMargin[2]),n}this.lastInsertedSvg=null,this._completed=!1,this._domains=new Map,this.graphDim={width:0,height:0},this.legendDim={width:0,height:0},this.NAVIGATE_LEFT=1,this.NAVIGATE_RIGHT=2,this.RESET_ALL_ON_UPDATE=0,this.RESET_SINGLE_ON_UPDATE=1,this.APPEND_ON_UPDATE=2,this.DEFAULT_LEGEND_MARGIN=10,this.root=null,this.tooltip=null,this._maxDomainReached=!1,this._minDomainReached=!1,this.domainPosition=new DomainPosition,this.Legend=null,this.legendScale=null,this.DSTDomain=[],this._init=function(){var t;return p.getDomain(p.options.start).map(function(t){return t.getTime()}).map(function(t){p._domains.set(t,p.getSubDomain(t).map(function(t){return{t:p._domainType[p.options.subDomain].extractUnit(t),v:null}}))}),p.root=d3.select(p.options.itemSelector).append("svg").attr("class","cal-heatmap-container"),p.tooltip=d3.select(p.options.itemSelector).attr("style",function(){var t=d3.select(p.options.itemSelector).attr("style");return(null!==t?t:"")+"position:relative;"}).append("div").attr("class","ch-tooltip"),p.root.attr("x",0).attr("y",0).append("svg").attr("class","graph"),p.Legend=new Legend(p),p.options.paintOnLoad&&(p.verticalDomainLabel="top"===p.options.label.position||"bottom"===p.options.label.position,p.domainVerticalLabelHeight=null===p.options.label.height?Math.max(25,2*p.options.cellSize):p.options.label.height,p.domainHorizontalLabelWidth=0,""===p.options.domainLabelFormat&&null===p.options.label.height&&(p.domainVerticalLabelHeight=0),p.verticalDomainLabel||(p.domainVerticalLabelHeight=0,p.domainHorizontalLabelWidth=p.options.label.width),p.paint(),!1!==p.options.nextSelector&&d3.select(p.options.nextSelector).on("click."+p.options.itemNamespace,function(t){return t.preventDefault(),p.loadNextDomain(1)}),!1!==p.options.previousSelector&&d3.select(p.options.previousSelector).on("click."+p.options.itemNamespace,function(t){return t.preventDefault(),p.loadPreviousDomain(1)}),p.Legend.redraw(p.graphDim.width-p.options.domainGutter-p.options.cellPadding),p.afterLoad(),t=p.getDomainKeys(),p.options.loadOnInit?p.getDatas(p.options.data,new Date(t[0]),p.getSubDomain(t[t.length-1]).pop(),function(){p.fill(),p.onComplete()}):p.onComplete(),p.checkIfMinDomainIsReached(t[0]),p.checkIfMaxDomainIsReached(p.getNextDomain().getTime())),!0},this.paint=function(a){const o=p.options;0===arguments.length&&(a=!1);let t=p.root.select(".graph").selectAll(".graph-domain").data(function(){const t=p.getDomainKeys();return a===p.NAVIGATE_LEFT?t.reverse():t},function(t){return t}),r=0,s=0;if(o.dayLabel&&"month"===o.domain&&"day"===o.subDomain){const h=["monday","tuesday","wednesday","thursday","friday","saturday"];o.weekStartOnMonday?h.push("sunday"):h.shif("sunday");var e=h.map(function(t){return p.formatDate(d3.time[t](new Date),"%a").charAt(0)});const g=this.root.append("svg").attr("class","day-name").attr("x",0).attr("y",0),d=g.selectAll("g").data(e).enter().append("g");d.append("rect").attr("class","day-name-rect").attr("width",o.cellSize).attr("height",o.cellSize).attr("x",0).attr("y",function(t,e){return e*o.cellSize+e*o.cellPadding}),d.append("text").attr("class","day-name-text").attr("dominant-baseline","central").attr("x",0).attr("y",function(t,e){return e*o.cellSize+e*o.cellPadding+o.cellSize/2}).text(function(t){return t})}const n=t.enter().append("svg").attr("width",function(t){return f(t,!0)}).attr("height",function(t){return D(t,!0)}).attr("x",function(t){return o.verticalOrientation?(p.graphDim.width=Math.max(p.graphDim.width,f(t,!0)),0):i(t,p.graphDim,"width",f(t,!0))}).attr("y",function(t){return o.verticalOrientation?i(t,p.graphDim,"height",D(t,!0)):(p.graphDim.height=Math.max(p.graphDim.height,D(t,!0)),0)}).attr("class",function(t){let e="graph-domain";const n=new Date(t);switch(o.domain){case"hour":e+=" h_"+n.getHours();case"day":e+=" d_"+n.getDate()+" dy_"+n.getDay();case"week":e+=" w_"+p.getWeekNumber(n);case"month":e+=" m_"+(n.getMonth()+1);case"year":e+=" y_"+n.getFullYear()}return e});function i(t,e,n,i){let o=0;switch(a){case!1:return o=e[n],e[n]+=i,p.domainPosition.setPosition(t,o),o;case p.NAVIGATE_RIGHT:return p.domainPosition.setPosition(t,e[n]),r=i,s=p.domainPosition.getPositionFromIndex(1),p.domainPosition.shiftRightBy(s),e[n];case p.NAVIGATE_LEFT:return o=-i,r=-o,s=e[n]-p.domainPosition.getLast(),p.domainPosition.setPosition(t,o),p.domainPosition.shiftLeftBy(r),o}}(p.lastInsertedSvg=n).append("rect").attr("width",function(t){return f(t,!0)-o.domainGutter-o.cellPadding}).attr("height",function(t){return D(t,!0)-o.domainGutter-o.cellPadding}).attr("class","domain-background");const l=n.append("svg").attr("x",function(){return"left"===o.label.position?p.domainHorizontalLabelWidth+o.domainMargin[3]:o.domainMargin[3]}).attr("y",function(){return"top"===o.label.position?p.domainVerticalLabelHeight+o.domainMargin[0]:o.domainMargin[0]}).attr("class","graph-subdomain-group"),u=l.selectAll("g").data(function(t){return p._domains.get(t)}).enter().append("g");u.append("rect").attr("class",function(t){return"graph-rect"+p.getHighlightClassName(t.t)+(null!==o.onClick?" hover_cursor":"")}).attr("width",o.cellSize).attr("height",o.cellSize).attr("x",function(t){return p.positionSubDomainX(t.t)}).attr("y",function(t){return p.positionSubDomainY(t.t)}).on("click",function(t,e){if(null!==o.onClick)return p.onClick(new Date(e.t),e.v)}).on("mouseover",function(t){if(null!==o.onMouseOver)return p.onMouseOver(new Date(t.t),t.v)}).on("mouseout",function(t){if(null!==o.onMouseOut)return p.onMouseOut(new Date(t.t),t.v)}).call(function(t){0<o.cellRadius&&t.attr("rx",o.cellRadius).attr("ry",o.cellRadius),null!==p.legendScale&&null!==o.legendColors&&o.legendColors.hasOwnProperty("base")&&t.attr("fill",o.legendColors.base),o.tooltip&&(t.on("mouseover",function(t,n){const i=this.parentNode.parentNode;function e(t){p.tooltip.html(t).attr("style","display: block;");var t=p.positionSubDomainX(n.t)-p.tooltip.node().offsetWidth/2+o.cellSize/2,e=p.positionSubDomainY(n.t)-p.tooltip.node().offsetHeight-o.cellSize/2;t+=parseInt(i.getAttribute("x"),10),e+=parseInt(i.getAttribute("y"),10),t+=parseInt(p.root.select(".graph").attr("x"),10),e+=parseInt(p.root.select(".graph").attr("y"),10),t+=parseInt(i.parentNode.getAttribute("x"),10),e+=parseInt(i.parentNode.getAttribute("y"),10),p.tooltip.attr("style","display: block; left: "+t+"px; top: "+e+"px;")}o.onTooltip?e(p.options.onTooltip(new Date(n.t),n.v)):e(p.getSubDomainTitle(n))}),t.on("mouseout",function(){p.tooltip.attr("style","display:none").html("")}))}),o.tooltip||u.append("title").text(function(t){return p.formatDate(new Date(t.t),o.subDomainDateFormat)}),""!==o.domainLabelFormat&&n.append("text").attr("class","graph-label").attr("y",function(t){let e=o.domainMargin[0];switch(o.label.position){case"top":e+=p.domainVerticalLabelHeight/2;break;case"bottom":e+=D(t)+p.domainVerticalLabelHeight/2}return e+o.label.offset.y*("right"===o.label.rotate&&"right"===o.label.position||"left"===o.label.rotate&&"left"===o.label.position?-1:1)}).attr("x",function(t){let e=o.domainMargin[3];switch(o.label.position){case"right":e+=f(t);break;case"bottom":case"top":e+=f(t)/2}return"right"===o.label.align?e+p.domainHorizontalLabelWidth-o.label.offset.x*("right"===o.label.rotate?-1:1):e+o.label.offset.x}).attr("text-anchor",function(){switch(o.label.align){case"start":case"left":return"start";case"end":case"right":return"end";default:return"middle"}}).attr("dominant-baseline",function(){return p.verticalDomainLabel?"middle":"top"}).text(function(t){return p.formatDate(new Date(t),o.domainLabelFormat)}).call(function(t){switch(o.label.rotate){case"right":t.attr("transform",function(t){let e="rotate(90), ";switch(o.label.position){case"right":e+="translate(-"+f(t)+" , -"+f(t)+")";break;case"left":e+="translate(0, -"+p.domainHorizontalLabelWidth+")"}return e});break;case"left":t.attr("transform",function(t){let e="rotate(270), ";switch(o.label.position){case"right":e+="translate(-"+(f(t)+p.domainHorizontalLabelWidth)+" , "+f(t)+")";break;case"left":e+="translate(-"+p.domainHorizontalLabelWidth+" , "+p.domainHorizontalLabelWidth+")"}return e})}}),null!==o.subDomainTextFormat&&u.append("text").attr("class",function(t){return"subdomain-text"+p.getHighlightClassName(t.t)}).attr("x",function(t){return p.positionSubDomainX(t.t)+o.cellSize/2}).attr("y",function(t){return p.positionSubDomainY(t.t)+o.cellSize/2}).attr("text-anchor","middle").attr("dominant-baseline","central").text(function(t){return p.formatDate(new Date(t.t),o.subDomainTextFormat)}),t=p.root.select(".graph").selectAll(".graph-domain").data(function(){const t=p.getDomainKeys();return a===p.NAVIGATE_LEFT?t.reverse():t},function(t){return t}),!1!==a&&t.transition().duration(o.animationDuration).attr("x",function(t){return o.verticalOrientation?0:p.domainPosition.getPosition(t)}).attr("y",function(t){return o.verticalOrientation?p.domainPosition.getPosition(t):0});const c=p.graphDim.width,m=p.graphDim.height;o.verticalOrientation?p.graphDim.height+=r-s:p.graphDim.width+=r-s,t.exit().transition().duration(o.animationDuration).attr("x",function(t){if(o.verticalOrientation)return 0;switch(a){case p.NAVIGATE_LEFT:return Math.min(p.graphDim.width,c);case p.NAVIGATE_RIGHT:return-f(t,!0)}}).attr("y",function(t){if(!o.verticalOrientation)return 0;switch(a){case p.NAVIGATE_LEFT:return Math.min(p.graphDim.height,m);case p.NAVIGATE_RIGHT:return-D(t,!0)}}).remove(),p.resize()}};CalHeatMap.prototype={init:function(t){"use strict";const e=this,n=e.options=mergeRecursive(e.options,t);if(!e._domainType.hasOwnProperty(n.domain)||"min"===n.domain||"x_"===n.domain.substring(0,2))throw new Error("The domain '"+n.domain+"' is not valid");if(!e._domainType.hasOwnProperty(n.subDomain)||"year"===n.subDomain)throw new Error("The subDomain '"+n.subDomain+"' is not valid");if(e._domainType[n.domain].level<=e._domainType[n.subDomain].level)throw new Error("'"+n.subDomain+"' is not a valid subDomain to '"+n.domain+"'");if(a(n.itemSelector,!1,"itemSelector"),-1===e.allowedDataType.indexOf(n.dataType))throw new Error("The data type '"+n.dataType+"' is not valid data type");if(d3.select(n.itemSelector).empty())throw new Error("The node '"+n.itemSelector+"' specified in itemSelector does not exist");try{a(n.nextSelector,!0,"nextSelector"),a(n.previousSelector,!0,"previousSelector")}catch(t){return console.log(t.message),!1}t.hasOwnProperty("subDomain")||(this.options.subDomain=function(t){switch(t){case"year":return"month";case"month":case"week":return"day";case"day":return"hour";default:return"min"}}(t.domain)),"string"==typeof n.itemNamespace&&""!==n.itemNamespace||(console.log("itemNamespace can not be empty, falling back to cal-heatmap"),n.itemNamespace="cal-heatmap");var i,o=["data","onComplete","onClick","onResize","onMouseOver","onMouseOut","afterLoad","afterLoadData","afterLoadPreviousDomain","afterLoadNextDomain","afterUpdate","onTooltip"];for(const s in o)t.hasOwnProperty(o[s])&&(n[o[s]]=t[o[s]]);if(n.subDomainDateFormat="string"==typeof n.subDomainDateFormat||"function"==typeof n.subDomainDateFormat?n.subDomainDateFormat:this._domainType[n.subDomain].format.date,n.domainLabelFormat="string"==typeof n.domainLabelFormat||"function"==typeof n.domainLabelFormat?n.domainLabelFormat:this._domainType[n.domain].format.legend,n.subDomainTextFormat="string"==typeof n.subDomainTextFormat&&""!==n.subDomainTextFormat||"function"==typeof n.subDomainTextFormat?n.subDomainTextFormat:null,n.domainMargin=r(n.domainMargin),n.legendMargin=r(n.legendMargin),n.highlight=e.expandDateSetting(n.highlight),n.itemName=function(t){if("string"==typeof t)return[t,t+(""!==t?"s":"")];if(Array.isArray(t))return 1===t.length?[t[0],t[0]+"s"]:2<t.length?t.slice(0,2):t;return["item","items"]}(n.itemName),n.colLimit=0<(i=n.colLimit)?i:null,n.rowLimit=function(t){if(0<t&&0<n.colLimit)return console.log("colLimit and rowLimit are mutually exclusive, rowLimit will be ignored"),null;return 0<t?t:null}(n.rowLimit),!t.hasOwnProperty("legendMargin"))switch(n.legendVerticalPosition){case"top":n.legendMargin[2]=e.DEFAULT_LEGEND_MARGIN;break;case"bottom":n.legendMargin[0]=e.DEFAULT_LEGEND_MARGIN;break;case"middle":case"center":n.legendMargin["right"===n.legendHorizontalPosition?3:1]=e.DEFAULT_LEGEND_MARGIN}if(!t.hasOwnProperty("label")||t.hasOwnProperty("label")&&!t.label.hasOwnProperty("align")){switch(n.label.position){case"left":n.label.align="right";break;case"right":n.label.align="left";break;default:n.label.align="center"}"left"===n.label.rotate?n.label.align="right":"right"===n.label.rotate&&(n.label.align="left")}function a(t,e,n){if(!(e&&!1===t||t instanceof Element||"string"==typeof t)||""===t)throw new Error("The "+n+" is not valid")}function r(t){switch("number"==typeof t&&(t=[t]),Array.isArray(t)||(console.log("Margin only takes an integer or an array of integers"),t=[0]),t.length){case 1:return[t[0],t[0],t[0],t[0]];case 2:return[t[0],t[1],t[0],t[1]];case 3:return[t[0],t[1],t[2],t[1]];case 4:return t;default:return t.slice(0,4)}}return t.hasOwnProperty("label")&&(!t.hasOwnProperty("label")||t.label.hasOwnProperty("offset"))||"left"!==n.label.position&&"right"!==n.label.position||(n.label.offset={x:10,y:15}),this._init()},expandDateSetting:function(t){"use strict";return(t=Array.isArray(t)?t:[t]).map(function(t){return"now"===t?new Date:t instanceof Date&&t}).filter(function(t){return!1!==t})},fill:function(t){"use strict";const i=this,o=i.options,e=(t=0===arguments.length?i.root.selectAll(".graph-domain"):t).selectAll("svg").selectAll("g").data(function(t){return i._domains.get(t)||[]});e.transition().duration(o.animationDuration).select("rect").attr("class",function(t){const e=i.getHighlightClassName(t.t).trim().split(" ");var n=i.dateIsLessThan(t.t,new Date);return null!==i.legendScale&&(null!==t.v||!o.hasOwnProperty("considerMissingDataAsZero")||o.considerMissingDataAsZero||o.legendColors.hasOwnProperty("base"))||e.push("graph-rect"),null!==t.v?e.push(i.Legend.getClass(t.v,null===i.legendScale)):o.considerMissingDataAsZero&&n&&e.push(i.Legend.getClass(0,null===i.legendScale)),null!==o.onClick&&e.push("hover_cursor"),e.join(" ")}).call(function(t){if(null===i.legendScale)return!1;t.attr("fill",function(t){return null===t.v&&o.hasOwnProperty("considerMissingDataAsZero")&&!o.considerMissingDataAsZero&&o.legendColors.hasOwnProperty("base")?o.legendColors.base:null!==o.legendColors&&o.legendColors.hasOwnProperty("empty")&&(0===t.v||null===t.v&&o.hasOwnProperty("considerMissingDataAsZero")&&o.considerMissingDataAsZero)?o.legendColors.empty:t.v<0&&0<o.legend[0]&&null!==o.legendColors&&o.legendColors.hasOwnProperty("overflow")?o.legendColors.overflow:i.legendScale(Math.min(t.v,o.legend[o.legend.length-1]))})}),e.transition().duration(o.animationDuration).select("title").text(function(t){return i.getSubDomainTitle(t)}),e.transition().duration(o.animationDuration).select("text").attr("class",function(t){return"subdomain-text"+i.getHighlightClassName(t.t)}).call(function(t){"function"==typeof o.subDomainTextFormat&&t.text(function(t){return o.subDomainTextFormat(t.t,t.v)})})},formatStringWithObject:function(t,e){"use strict";for(const i in e){var n;e.hasOwnProperty(i)&&(n=new RegExp("\\{"+i+"\\}","gi"),t=t.replace(n,e[i]))}return t},triggerEvent:function(t,e,n){"use strict";return!!(3===arguments.length&&n||null===this.options[t])||("function"==typeof this.options[t]?("function"==typeof e&&(e=e()),this.options[t].apply(this,e)):(console.log("Provided callback for "+t+" is not a function."),!1))},onClick:function(t,e){"use strict";return this.triggerEvent("onClick",[t,e])},onMouseOver:function(t,e){"use strict";return this.triggerEvent("onMouseOver",[t,e])},onMouseOut:function(t,e){"use strict";return this.triggerEvent("onMouseOut",[t,e])},afterLoad:function(){"use strict";return this.triggerEvent("afterLoad")},onComplete:function(){"use strict";var t=this.triggerEvent("onComplete",[],this._completed);return this._completed=!0,t},onResize:function(t,e){"use strict";return this.triggerEvent("onResize",[t,e])},afterLoadPreviousDomain:function(e){"use strict";const n=this;return this.triggerEvent("afterLoadPreviousDomain",function(){const t=n.getSubDomain(e);return[t.shift(),t.pop()]})},afterLoadNextDomain:function(e){"use strict";const n=this;return this.triggerEvent("afterLoadNextDomain",function(){const t=n.getSubDomain(e);return[t.shift(),t.pop()]})},onMinDomainReached:function(t){"use strict";return this._minDomainReached=t,this.triggerEvent("onMinDomainReached",[t])},onMaxDomainReached:function(t){"use strict";return this._maxDomainReached=t,this.triggerEvent("onMaxDomainReached",[t])},checkIfMinDomainIsReached:function(t,e){"use strict";this.minDomainIsReached(t)&&this.onMinDomainReached(!0),2===arguments.length&&this._maxDomainReached&&!this.maxDomainIsReached(e)&&this.onMaxDomainReached(!1)},checkIfMaxDomainIsReached:function(t,e){"use strict";this.maxDomainIsReached(t)&&this.onMaxDomainReached(!0),2===arguments.length&&this._minDomainReached&&!this.minDomainIsReached(e)&&this.onMinDomainReached(!1)},afterUpdate:function(){"use strict";return this.triggerEvent("afterUpdate")},formatNumber:d3.format(",d"),formatDate:function(t,e){"use strict";if("function"==typeof(e=arguments.length<2?"title":e))return e(t);{const n=d3.timeFormat(e);return n(t)}},getSubDomainTitle:function(e){"use strict";if(null!==e.v||this.options.considerMissingDataAsZero){let t=e.v;return null===t&&this.options.considerMissingDataAsZero&&(t=0),this.formatStringWithObject(this.options.subDomainTitleFormat.filled,{count:this.formatNumber(t),name:this.options.itemName[1!==t?1:0],connector:this._domainType[this.options.subDomain].format.connector,date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})}return this.formatStringWithObject(this.options.subDomainTitleFormat.empty,{date:this.formatDate(new Date(e.t),this.options.subDomainDateFormat)})},loadNextDomain:function(t){"use strict";if(this._maxDomainReached||0===t)return!1;t=this.loadNewDomains(this.NAVIGATE_RIGHT,this.getDomain(this.getNextDomain(),t));return this.afterLoadNextDomain(t.end),this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(),t.start),!0},loadPreviousDomain:function(t){"use strict";if(this._minDomainReached||0===t)return!1;t=this.loadNewDomains(this.NAVIGATE_LEFT,this.getDomain(this.getDomainKeys()[0],-t).reverse());return this.afterLoadPreviousDomain(t.start),this.checkIfMinDomainIsReached(t.start,t.end),!0},loadNewDomains:function(t,e){"use strict";const n=this;var i=t===this.NAVIGATE_LEFT;let o=-1,a=e.length,r=this.getDomainKeys();function s(t){return{t:n._domainType[n.options.subDomain].extractUnit(t),v:null}}for(;++o<a;){if(i&&this.minDomainIsReached(e[o])){e=e.slice(0,o+1);break}if(!i&&this.maxDomainIsReached(e[o])){e=e.slice(0,o);break}}for(e=e.slice(-this.options.range),o=0,a=e.length;o<a;o++)this._domains.set(e[o].getTime(),this.getSubDomain(e[o]).map(s)),this._domains.delete(i?r.pop():r.shift());return r=this.getDomainKeys(),i&&(e=e.reverse()),this.paint(t),this.getDatas(this.options.data,e[0],this.getSubDomain(e[e.length-1]).pop(),function(){n.fill(n.lastInsertedSvg)}),{start:e[i?0:1],end:r[r.length-1]}},maxDomainIsReached:function(t){"use strict";return null!==this.options.maxDate&&this.options.maxDate.getTime()<t},minDomainIsReached:function(t){"use strict";return null!==this.options.minDate&&this.options.minDate.getTime()>=t},getDomainKeys:function(){"use strict";return Array.from(this._domains.keys()).map(function(t){return parseInt(t,10)}).sort(function(t,e){return t-e})},positionSubDomainX:function(t){"use strict";t=this._domainType[this.options.subDomain].position.x(new Date(t));return t*this.options.cellSize+t*this.options.cellPadding},positionSubDomainY:function(t){"use strict";t=this._domainType[this.options.subDomain].position.y(new Date(t));return t*this.options.cellSize+t*this.options.cellPadding},getSubDomainColumnNumber:function(e){"use strict";if(0<this.options.rowLimit){let t=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof t&&(t=t(e)),Math.ceil(t/this.options.rowLimit)}let t=this._domainType[this.options.subDomain].defaultColumnNumber;return"function"==typeof t&&(t=t(e)),this.options.colLimit||t},getSubDomainRowNumber:function(e){"use strict";if(0<this.options.colLimit){let t=this._domainType[this.options.subDomain].maxItemNumber;return"function"==typeof t&&(t=t(e)),Math.ceil(t/this.options.colLimit)}let t=this._domainType[this.options.subDomain].defaultRowNumber;return"function"==typeof t&&(t=t(e)),this.options.rowLimit||t},getHighlightClassName:function(t){"use strict";if(t=new Date(t),0<this.options.highlight.length)for(const e in this.options.highlight)if(this.dateIsEqual(this.options.highlight[e],t))return this.isNow(this.options.highlight[e])?" highlight-now":" highlight";return""},isNow:function(t){"use strict";return this.dateIsEqual(t,new Date)},dateIsEqual:function(t,e){"use strict";switch(t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),this.options.subDomain){case"x_min":case"min":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours()&&t.getMinutes()===e.getMinutes();case"x_hour":case"hour":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()&&t.getHours()===e.getHours();case"x_day":case"day":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate();case"x_week":case"week":return t.getFullYear()===e.getFullYear()&&this.getWeekNumber(t)===this.getWeekNumber(e);case"x_month":case"month":return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth();default:return!1}},dateIsLessThan:function(t,e){"use strict";function n(t,e){switch(e){case"x_min":case"min":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()).getTime();case"x_hour":case"hour":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime();case"x_day":case"day":return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();case"x_week":case"week":case"x_month":case"month":return new Date(t.getFullYear(),t.getMonth()).getTime();default:return t.getTime()}}return t instanceof Date||(t=new Date(t)),e instanceof Date||(e=new Date(e)),n(t,this.options.subDomain)<n(e,this.options.subDomain)},getDayOfYear:d3.timeFormat("%j"),getWeekNumber:function(t){"use strict";const e=!0===this.options.weekStartOnMonday?d3.timeFormat("%W"):d3.timeFormat("%U");return e(t)},getMonthWeekNumber:function(t){"use strict";"number"==typeof t&&(t=new Date(t));var e=this.getWeekNumber(new Date(t.getFullYear(),t.getMonth()));return this.getWeekNumber(t)-e-1},getWeekNumberInYear:function(t){"use strict";"number"==typeof t&&new Date(t)},getDayCountInMonth:function(t){"use strict";return this.getEndOfMonth(t).getDate()},getDayCountInYear:function(t){"use strict";return"number"==typeof t&&(t=new Date(t)),1===new Date(t.getFullYear(),1,29).getMonth()?366:365},getWeekDay:function(t){"use strict";return!1===this.options.weekStartOnMonday?t.getDay():0===t.getDay()?6:t.getDay()-1},getEndOfMonth:function(t){"use strict";return"number"==typeof t&&(t=new Date(t)),new Date(t.getFullYear(),t.getMonth()+1,0)},jumpDate:function(t,e,n){"use strict";const i=new Date(t);switch(n){case"hour":i.setHours(i.getHours()+e);break;case"day":i.setHours(i.getHours()+24*e);break;case"week":i.setHours(i.getHours()+24*e*7);break;case"month":i.setMonth(i.getMonth()+e);break;case"year":i.setFullYear(i.getFullYear()+e)}return new Date(i)},getMinuteDomain:function(t,e){"use strict";t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());let n=null;return n=e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()):new Date(+t+1e3*e*60),d3.timeMinutes(Math.min(t,n),Math.max(t,n))},getHourDomain:function(t,e){"use strict";t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());let n=null;e instanceof Date?n=new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours()):(n=new Date(t)).setHours(n.getHours()+e);const i=d3.timeHours(Math.min(t,n),Math.max(t,n));let o=0;var a=i.length;for(o=0;o<a;o++)if(0<o&&i[o].getHours()===i[o-1].getHours()){this.DSTDomain.push(i[o].getTime()),i.splice(o,1);break}return"number"==typeof e&&i.length>Math.abs(e)&&i.splice(i.length-1,1),i},getDayDomain:function(t,e){"use strict";t=new Date(t.getFullYear(),t.getMonth(),t.getDate());let n=null;return n=e instanceof Date?new Date(e.getFullYear(),e.getMonth(),e.getDate()):(n=new Date(t),new Date(n.setDate(n.getDate()+parseInt(e,10)))),d3.timeDays(Math.min(t,n),Math.max(t,n))},getWeekDomain:function(t,e){"use strict";let n;!1===this.options.weekStartOnMonday?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()):1===t.getDay()?n=new Date(t.getFullYear(),t.getMonth(),t.getDate()):0===t.getDay()?(n=new Date(t.getFullYear(),t.getMonth(),t.getDate())).setDate(n.getDate()-6):n=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()+1);const i=new Date(n);let o=e;return"object"!=typeof e&&(o=new Date(i.setDate(i.getDate()+7*e))),!0===this.options.weekStartOnMonday?d3.timeMondays(Math.min(n,o),Math.max(n,o)):d3.timeSundays(Math.min(n,o),Math.max(n,o))},getMonthDomain:function(t,e){"use strict";t=new Date(t.getFullYear(),t.getMonth());let n=null;return n=e instanceof Date?new Date(e.getFullYear(),e.getMonth()):(n=new Date(t)).setMonth(n.getMonth()+e),d3.timeMonths(Math.min(t,n),Math.max(t,n))},getYearDomain:function(t,e){"use strict";var n=new Date(t.getFullYear(),0);let i=null;return i=e instanceof Date?new Date(e.getFullYear(),0):new Date(t.getFullYear()+e,0),d3.timeYears(Math.min(n,i),Math.max(n,i))},getDomain:function(t,e){"use strict";switch("number"==typeof t&&(t=new Date(t)),arguments.length<2&&(e=this.options.range),this.options.domain){case"hour":var n=this.getHourDomain(t,e);return"number"==typeof e&&n.length<e&&(0<e?n.push(this.getHourDomain(n[n.length-1],2)[1]):n.shift(this.getHourDomain(n[0],-2)[0])),n;case"day":return this.getDayDomain(t,e);case"week":return this.getWeekDomain(t,e);case"month":return this.getMonthDomain(t,e);case"year":return this.getYearDomain(t,e)}},getSubDomain:function(t){"use strict";"number"==typeof t&&(t=new Date(t));const o=this;switch(this.options.subDomain){case"x_min":case"min":return this.getMinuteDomain(t,function(t){switch(t){case"hour":return 60;case"day":return 1440;case"week":return 10080}}(this.options.domain));case"x_hour":case"hour":return this.getHourDomain(t,function(t,e){switch(e){case"day":return 24;case"week":return 168;case"month":return 24*o.getDayCountInMonth(t)}}(t,this.options.domain));case"x_day":case"day":return this.getDayDomain(t,function(t,e){switch(e){case"year":return o.getDayCountInYear(t);case"month":return o.getDayCountInMonth(t);case"week":return 7}}(t,this.options.domain));case"x_week":case"week":return this.getWeekDomain(t,function(n,t){if("month"===t){var i=new Date(n.getFullYear(),n.getMonth()+1,0);let t=o.getWeekNumber(i),e=o.getWeekNumber(new Date(n.getFullYear(),n.getMonth()));return e>t&&(e=0,t++),t-e+1}if("year"===t)return o.getWeekNumber(new Date(n.getFullYear(),11,31))}(t,this.options.domain));case"x_month":case"month":return this.getMonthDomain(t,12)}},getNextDomain:function(t){"use strict";return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().pop(),t,this.options.domain),1)[0]},getPreviousDomain:function(t){"use strict";return 0===arguments.length&&(t=1),this.getDomain(this.jumpDate(this.getDomainKeys().shift(),-t,this.options.domain),1)[0]},getDatas:function(e,n,i,o,a,r){"use strict";const s=this;arguments.length<5&&(a=!0),arguments.length<6&&(r=this.APPEND_ON_UPDATE);function l(t){!1!==a?"function"==typeof a?t=a(t):"function"==typeof s.options.afterLoadData?t=s.options.afterLoadData(t):console.log("Provided callback for afterLoadData is not a function."):"csv"!==s.options.dataType&&"tsv"!==s.options.dataType||(t=this.interpretCSV(t)),s.parseDatas(t,r,n,i),"function"==typeof o&&o()}switch(typeof e){case"string":if(""===e)return l({}),!0;{var u=this.parseURI(e,n,i);const c={method:"GET"};if(null!==s.options.dataPostPayload&&(c.method="POST"),null!==s.options.dataPostPayload&&(c.body=this.parseURI(s.options.dataPostPayload,n,i)),null!==s.options.dataRequestHeaders){const m=new Headers;for(const h in s.options.dataRequestHeaders)s.options.dataRequestHeaders.hasOwnProperty(h)&&m.append(h,s.options.dataRequestHeaders[h]);c.headers=m}let t=null;switch(this.options.dataType){case"json":t=d3.json(u,c);break;case"csv":t=d3.csv(u,c);break;case"tsv":t=d3.dsv("\t",u,c);break;case"txt":t=d3.text(u,c)}t.then(l)}return!1;case"object":if(e===Object(e))return l(e),!1;default:return l({}),!0}},parseDatas:function(e,n,i,o){"use strict";n===this.RESET_ALL_ON_UPDATE&&this._domains.forEach(function(t){t.forEach(function(t,e,n){n[e].v=null})});const a={};function r(t){return t.t}for(const l in e){var s=new Date(1e3*l);let t=this.getDomain(s)[0].getTime();if(0<=this.DSTDomain.indexOf(t)&&this._domains.has(t-36e5)&&(t-=36e5),!isNaN(l)&&e.hasOwnProperty(l)&&this._domains.has(t)&&(t>=+i&&t<+o)){const u=this._domains.get(t);a.hasOwnProperty(t)||(a[t]=u.map(r));s=a[t].indexOf(this._domainType[this.options.subDomain].extractUnit(s));n===this.RESET_SINGLE_ON_UPDATE||isNaN(u[s].v)?u[s].v=e[l]:u[s].v+=e[l]}}},parseURI:function(t,e,n){"use strict";return t=(t=(t=(t=t.replace(/\{\{t:start\}\}/g,e.getTime()/1e3)).replace(/\{\{t:end\}\}/g,n.getTime()/1e3)).replace(/\{\{d:start\}\}/g,e.toISOString())).replace(/\{\{d:end\}\}/g,n.toISOString())},interpretCSV:function(t){"use strict";const e={};var n=Object.keys(t[0]);let i,o;for(i=0,o=t.length;i<o;i++)e[t[i][n[0]]]=+t[i][n[1]];return e},resize:function(){"use strict";var t=this;const e=t.options,n=e.displayLegend?t.Legend.getDim("width")+e.legendMargin[1]+e.legendMargin[3]:0,i=e.displayLegend?t.Legend.getDim("height")+e.legendMargin[0]+e.legendMargin[2]:0,o=t.graphDim.width-e.domainGutter-e.cellPadding,a=t.graphDim.height-e.domainGutter-e.cellPadding;function r(){return"middle"===e.legendVerticalPosition||"center"===e.legendVerticalPosition?Math.max(a,i):a+i}function s(){return"middle"===e.legendVerticalPosition||"center"===e.legendVerticalPosition?o+n:Math.max(o,n)}this.root.transition().duration(e.animationDuration).attr("width",s()).attr("height",r()),this.root.select(".graph").transition().duration(e.animationDuration).attr("y",function(){return"top"===e.legendVerticalPosition?i:0}).attr("x",function(){let t=0;return e.dayLabel&&"month"===e.domain&&"day"===e.subDomain&&(t=e.cellSize+e.cellPadding),"middle"!==e.legendVerticalPosition&&"center"!==e.legendVerticalPosition||"left"!==e.legendHorizontalPosition?t:n+t}),this.onResize(r(),s())},next:function(t){"use strict";return this.loadNextDomain(t=0===arguments.length?1:t)},previous:function(t){"use strict";return this.loadPreviousDomain(t=0===arguments.length?1:t)},jumpTo:function(t,e){"use strict";arguments.length<2&&(e=!1);var n=this.getDomainKeys(),i=n[0],n=n[n.length-1];return t<i?this.loadPreviousDomain(this.getDomain(i,t).length):e?this.loadNextDomain(this.getDomain(i,t).length):n<t&&this.loadNextDomain(this.getDomain(n,t).length)},rewind:function(){"use strict";this.jumpTo(this.options.start,!0)},update:function(t,e,n){"use strict";0===arguments.length&&(t=this.options.data),arguments.length<2&&(e=!0),arguments.length<3&&(n=this.RESET_ALL_ON_UPDATE);var i=this.getDomainKeys();const o=this;this.getDatas(t,new Date(i[0]),this.getSubDomain(i[i.length-1]).pop(),function(){o.fill(),o.afterUpdate()},e,n)},setLegend:function(){"use strict";var t=this.options.legend.slice(0);1<=arguments.length&&Array.isArray(arguments[0])&&(this.options.legend=arguments[0]),2<=arguments.length&&(Array.isArray(arguments[1])&&2<=arguments[1].length?this.options.legendColors=[arguments[1][0],arguments[1][1]]:this.options.legendColors=arguments[1]),(0<arguments.length&&!arrayEquals(t,this.options.legend)||2<=arguments.length)&&(this.Legend.buildColors(),this.fill()),this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding)},removeLegend:function(){"use strict";return!!this.options.displayLegend&&(this.options.displayLegend=!1,this.Legend.remove(),!0)},showLegend:function(){"use strict";return!this.options.displayLegend&&(this.options.displayLegend=!0,this.Legend.redraw(this.graphDim.width-this.options.domainGutter-this.options.cellPadding),!0)},highlight:function(t){"use strict";return 0<(this.options.highlight=this.expandDateSetting(t)).length&&(this.fill(),!0)},destroy:function(t){"use strict";return this.root.transition().duration(this.options.animationDuration).attr("width",0).attr("height",0).remove().each(function(){"function"==typeof t?t():void 0!==t&&console.log("Provided callback for destroy() is not a function.")}),null},getSVG:function(){"use strict";const i={".cal-heatmap-container":{},".graph":{},".graph-rect":{},"rect.highlight":{},"rect.now":{},"rect.highlight-now":{},"text.highlight":{},"text.now":{},"text.highlight-now":{},".domain-background":{},".graph-label":{},".subdomain-text":{},".q0":{},".qi":{}};for(let t=1,e=this.options.legend.length+1;t<=e;t++)i[".q"+t]={};const t=this.root,o=["stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-miterlimit","fill","fill-opacity","fill-rule","marker","marker-start","marker-mid","marker-end","alignement-baseline","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","kerning","text-anchor","shape-rendering","text-transform","font-family","font","font-size","font-weight"];function e(t,e,n){-1!==o.indexOf(e)&&(i[t][e]=n)}for(const s in i)if(i.hasOwnProperty(s)){n=s;var n=t.select(n).node();if(null!==n)if("getComputedStyle"in window){const l=getComputedStyle(n,null);if(0!==l.length)for(let t=0;t<l.length;t++)e(s,l.item(t),l.getPropertyValue(l.item(t)));else for(const u in l)l.hasOwnProperty(u)&&e(s,u,l[u])}else if("currentStyle"in n){var a=n.currentStyle;for(const c in a)e(s,c,a[c])}}let r='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><style type="text/css"><![CDATA[ ';for(const m in i){r+=m+" {\n";for(const h in i[m])r+="\t"+h+":"+i[m][h]+";\n";r+="}\n"}return r=(r+="]]></style>")+(new XMLSerializer).serializeToString(this.root[0][0])+"</svg>"}};var DomainPosition=function(){"use strict";this.positions=new Map},Legend=(DomainPosition.prototype.getPosition=function(t){"use strict";return this.positions.get(t)},DomainPosition.prototype.getPositionFromIndex=function(t){"use strict";var e=this.getKeys();return this.positions.get(e[t])},DomainPosition.prototype.getLast=function(){"use strict";var t=this.getKeys();return this.positions.get(t[t.length-1])},DomainPosition.prototype.setPosition=function(t,e){"use strict";this.positions.set(t,e)},DomainPosition.prototype.shiftRightBy=function(n){"use strict";const t=this.positions,i=this;t.forEach(function(t,e){i.positions.set(e,t-n)});var e=this.getKeys();this.positions.delete(e[0])},DomainPosition.prototype.shiftLeftBy=function(n){"use strict";const t=this.positions,i=this;t.forEach(function(t,e){i.positions.set(e,t+n)});var e=this.getKeys();this.positions.delete(e[e.length-1])},DomainPosition.prototype.getKeys=function(){"use strict";return Array.from(this.positions.keys()).sort(function(t,e){return parseInt(t,10)-parseInt(e,10)})},function(t){"use strict";this.calendar=t,this.computeDim(),null!==t.options.legendColors&&this.buildColors()});function mergeRecursive(e,n){"use strict";for(const i in n)try{n[i].constructor===Object?e[i]=mergeRecursive(e[i],n[i]):e[i]=n[i]}catch(t){e[i]=n[i]}return e}function arrayEquals(e,n){"use strict";if(!n||!e)return!1;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]instanceof Array&&n[t]instanceof Array){if(!arrayEquals(e[t],n[t]))return!1}else if(e[t]!==n[t])return!1;return!0}Legend.prototype.computeDim=function(){"use strict";var t=this.calendar.options;this.dim={width:t.legendCellSize*(t.legend.length+1)+t.legendCellPadding*t.legend.length,height:t.legendCellSize}},Legend.prototype.remove=function(){"use strict";this.calendar.root.select(".graph-legend").remove(),this.calendar.resize()},Legend.prototype.redraw=function(t){"use strict";if(!this.calendar.options.displayLegend)return!1;const e=this,n=this.calendar;let i=n.root,o;const a=n.options,r=(this.computeDim(),a.legend.slice(0)),s=(r.push(r[r.length-1]+1),n.root.select(".graph-legend"));function l(t){t.attr("width",a.legendCellSize).attr("height",a.legendCellSize).attr("x",function(t,e){return e*(a.legendCellSize+a.legendCellPadding)})}function u(){switch(a.legendHorizontalPosition){case"right":return"center"===a.legendVerticalPosition||"middle"===a.legendVerticalPosition?t+a.legendMargin[3]:t-e.getDim("width")-a.legendMargin[1];case"middle":case"center":return Math.round(t/2-e.getDim("width")/2);default:return a.legendMargin[3]}}function c(){return"bottom"===a.legendVerticalPosition?n.graphDim.height+a.legendMargin[0]-a.domainGutter-a.cellPadding:a.legendMargin[0]}(o=s.empty()?((i="top"===a.legendVerticalPosition?i.insert("svg",".graph"):i.append("svg")).attr("x",u()).attr("y",c()),i.attr("class","graph-legend").attr("height",e.getDim("height")).attr("width",e.getDim("width")).append("g").selectAll().data(r)):(i=s).select("g").selectAll("rect").data(r)).enter().append("rect").call(l).attr("class",function(t){return n.Legend.getClass(t,null===n.legendScale)}).attr("fill-opacity",0).call(function(t){null!==n.legendScale&&null!==a.legendColors&&a.legendColors.hasOwnProperty("base")&&t.attr("fill",a.legendColors.base)}).append("title"),o.exit().transition().duration(a.animationDuration).attr("fill-opacity",0).remove(),o.transition().delay(function(t,e){return a.animationDuration*e/10}).call(l).attr("fill-opacity",1).call(function(t){t.attr("fill",function(t,e){return null===n.legendScale?"":0===e?n.legendScale(t-1):n.legendScale(a.legend[e-1])}),t.attr("class",function(t){return n.Legend.getClass(t,null===n.legendScale)})}),o.select("title").text(function(t,e){return 0===e?n.formatStringWithObject(a.legendTitleFormat.lower,{min:a.legend[e],name:a.itemName[1]}):e===r.length-1?n.formatStringWithObject(a.legendTitleFormat.upper,{max:a.legend[e-1],name:a.itemName[1]}):n.formatStringWithObject(a.legendTitleFormat.inner,{down:a.legend[e-1],up:a.legend[e],name:a.itemName[1]})}),i.transition().duration(a.animationDuration).attr("x",u()).attr("y",c()).attr("width",e.getDim("width")).attr("height",e.getDim("height")),i.select("g").transition().duration(a.animationDuration).attr("transform",function(){return"vertical"===a.legendOrientation?"rotate(90 "+a.legendCellSize/2+" "+a.legendCellSize/2+")":""}),n.resize()},Legend.prototype.getDim=function(t){"use strict";var e="horizontal"===this.calendar.options.legendOrientation;switch(t){case"width":return this.dim[e?"width":"height"];case"height":return this.dim[e?"height":"width"]}},Legend.prototype.buildColors=function(){"use strict";const t=this.calendar.options;if(null===t.legendColors)return this.calendar.legendScale=null,!1;let e=[];if(Array.isArray(t.legendColors))e=t.legendColors;else{if(!t.legendColors.hasOwnProperty("min")||!t.legendColors.hasOwnProperty("max"))return t.legendColors=null,!1;e=[t.legendColors.min,t.legendColors.max]}const n=t.legend.slice(0),i=(0<n[0]?n.unshift(0):n[0]<=0&&n.unshift(n[0]-(n[n.length-1]-n[0])/n.length),d3.scaleLinear().range(e).interpolate(d3.interpolateHcl).domain([d3.min(n),d3.max(n)]));var o=n.map(function(t){return i(t)});return this.calendar.legendScale=d3.scaleThreshold().domain(t.legend).range(o),!0},Legend.prototype.getClass=function(n,t){"use strict";if(null===n||isNaN(n))return"";let i=[this.calendar.options.legend.length+1];for(let t=0,e=this.calendar.options.legend.length-1;t<=e;t++){if(0<this.calendar.options.legend[0]&&n<0){i=["1","i"];break}if(n<=this.calendar.options.legend[t]){i=[t+1];break}}return 0===n&&i.push(0),i.unshift(""),(i.join(" r")+(t?i.join(" q"):"")).trim()},"function"==typeof define&&define.amd?define(["d3"],function(){"use strict";return CalHeatMap}):"object"==typeof module&&module.exports?module.exports=CalHeatMap:window.CalHeatMap=CalHeatMap;